{% extends 'base.html' %}
{% load static %}


{% block title %}
{% endblock %}

{% block content %}
<div class="cart-form">
  <h3>장바구니</h3>
  <table class="cart-wrap">
    <col style="width:200px;">
    <col style="width:400px;">
    <col style="width:150px;">
    <col style="width:200px;">
    <col style="width:100px;">
    <col style="width:200px;">
    <thead>
      <tr>
        <th>제품이미지</th>
        <th>제품명</th>
        <th>제품수량</th>
        <th>제품삭제</th>
        <th>제품단가</th>
        <th>총금액</th>
      </tr>
    </thead>
    <tbody>
      {% for it in cart %}
        {% with item=it.item %}
        <tr>
          <!-- 제품 이미지 -->
          <th class="cart-img">
            <a href="{{ item.get_absolute_url }}">
              <img src="{{item.item_image.url }}" class="img-thumbnail">
            </a>
          </th>
          <!-- 제품명 -->
          <td>
            <a href="{{ item.item_detail.url }}">{{ item.item_title }}</a>
          </td>
          <!-- 제품 수량-->
          <td>
            <form class="" action="{% url 'cart:add_cart' item.id %}" method="post">
              {{ it.quantity_form.quantity }}
              {{ it.quantity_form.is_update }}
              <input type="submit" class="btn btn-primary" value="Update">
              {% csrf_token %}
            </form>
          <!-- 제품 삭제 -->
          </td>
          <td><a href="{% url 'cart:remove_cart' item.id %}">Remove</a></td>
          <!-- 제품 단가-->
          <td class="num">{{ it.item_price }}원</td>
          <!-- 토탈 금액 -->
          <td class=""><b>{{it.total_price}}</b>원</td>
        </tr>
        {% endwith %}
      {% endfor %}

      {% if cart.coupon %}
        <tr class="subtotal">
          <td>Subtotal</td>
          <td colspan="4"></td>
          <td>${{ cart.get_product_total }}</td>
        </tr>
        <tr>
          <td>"{{cart.coupon.code}}" coupon({{ cart.coupon.amount }})</td>
          <td colspan="4"></td>
          <td>- {{ cart.get_discount_total|floatformat:"2" }}</td>
        </tr>
      {% endif %}
      <tr>
        <form action="{% url 'coupon:add' %}" method="post">
            {{add_coupon}}
            <td><input type="submit" value="Add"></td>
            {% csrf_token %}
        </form>
      </tr>
      <!-- 총 금액 -->
      <tr class="cart-total-price" style="height: 60px;">
        <td>합계 금액</td>
        <td colspan="4"></td>
        <td class="num">총 <b>{{ cart.get_total_price|floatformat:"2" }}</b> 원</td>
      </tr>
    </tbody>
  </table>


    <div class="cart-bottom">
      <button type="submit" class="cart-check">
        <a href="{% url 'order:order_create' %}" class="btn btn-primary">주문하기</a>
      </button>
    </div>
    <div class="keep-shopping">
    <a href="{% url 'item:item_list' %}">계속 쇼핑하기</a>
    </div>
</div>
{% endblock %}
